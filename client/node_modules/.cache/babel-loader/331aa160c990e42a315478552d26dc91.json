{"ast":null,"code":"import _objectSpread from\"/Users/kristinhenno/Documents/Repositories/stripe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/kristinhenno/Documents/Repositories/stripe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/kristinhenno/Documents/Repositories/stripe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/kristinhenno/Documents/Repositories/stripe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/kristinhenno/Documents/Repositories/stripe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/kristinhenno/Documents/Repositories/stripe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/kristinhenno/Documents/Repositories/stripe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'./App.css';import{loadStripe}from'@stripe/stripe-js';import{Elements}from\"@stripe/react-stripe-js\";import Success from'./components/Success';import Cart from'./components/Cart';import ProductList from'./components/ProductList';import StripeContext from\"./components/Context\";import axios from\"axios\";import{BrowserRouter,Switch,Route,Link}from\"react-router-dom\";import{utimes}from'fs';import{makeStyles}from'@material-ui/core/styles';import Paper from'@material-ui/core/Paper';import Tab from'@material-ui/core/Tab';var useStyles=makeStyles({root:{flexGrow:1}});// import styled from \"styled-components\";\nvar stripePromise=loadStripe('pk_test_9cWSl1Mlu5mEFLGQajwgixZx00gIx5qQeQ');var App=/*#__PURE__*/function(_React$Component){_inherits(App,_React$Component);var _super=_createSuper(App);function App(props){var _this;_classCallCheck(this,App);_this=_super.call(this,props);_this.addItem=function(item){var cart=_this.state.cart;console.log(cart);if(cart[item.id]){cart[item.id].quantity+=item.quantity;}else{cart[item.id]=item;}localStorage.setItem(\"cart\",JSON.stringify(cart));_this.setState({cart:cart});};_this.removeItem=function(item){var cart=_this.state.cart;if(cart[item.id]){cart[item.id].quantity-=item.quantity;if(cart[item.id].quantity===0){delete cart[item.id];}}localStorage.setItem(\"cart\",JSON.stringify(cart));_this.setState({cart:cart});};_this.toCheckout=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var cart,itemKeys,checkoutArray,i,price,stripe,response,session,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:cart=_this.state.cart;itemKeys=Object.keys(_this.state.cart||{});checkoutArray=[];for(i=0;i<itemKeys.length;i++){console.log(cart[itemKeys[i]].product.name);price=cart[itemKeys[i]].product.price*100;console.log(price);checkoutArray.push({price_data:{currency:'usd',product_data:{name:cart[itemKeys[i]].product.name},unit_amount:price},quantity:cart[itemKeys[i]].quantity});console.log(checkoutArray);}// Get Stripe.js instance\n_context.next=6;return stripePromise;case 6:stripe=_context.sent;_context.next=9;return fetch('/create-checkout-session',{method:'POST',headers:{Accept:'application/json','Content-type':'application/json'},body:JSON.stringify({data:{payment_method_types:['card'],line_items:checkoutArray,mode:'payment',allow_promotion_codes:true}})});case 9:response=_context.sent;console.log(response);_context.next=13;return response.json();case 13:session=_context.sent;console.log(session);// When the customer clicks on the button, redirect them to Checkout.\n_context.next=17;return stripe.redirectToCheckout({sessionId:session.id});case 17:result=_context.sent;if(result.error){// If `redirectToCheckout` fails due to a browser or network\n// error, display the localized error message to your customer\n// using `result.error.message`.\n}case 19:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.state={cart:[],products:[]};// this.routerRef = React.createRef();\nreturn _this;}_createClass(App,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var cart,products;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:cart=localStorage.getItem(\"cart\");_context2.next=3;return axios.get('/products');case 3:products=_context2.sent;cart=cart?JSON.parse(cart):{};this.setState({products:products.data,cart:cart});case 6:case\"end\":return _context2.stop();}}},_callee2,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){console.log(this.state.cart);return/*#__PURE__*/React.createElement(StripeContext.Provider,{value:_objectSpread(_objectSpread({},this.state),{},{removeItem:this.removeItem,addItem:this.addItem,toCheckout:this.toCheckout})},/*#__PURE__*/React.createElement(BrowserRouter,null,/*#__PURE__*/React.createElement(Paper,null,/*#__PURE__*/React.createElement(Tab,{label:\"Products\",to:\"/\",component:Link}),/*#__PURE__*/React.createElement(Tab,{label:\"Cart\",to:\"/cart\",component:Link})),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/\",component:ProductList})),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/success\",component:Success})),/*#__PURE__*/React.createElement(Switch,null,/*#__PURE__*/React.createElement(Route,{exact:true,path:\"/cart\",component:Cart})))));}}]);return App;}(React.Component);export default App;","map":{"version":3,"sources":["/Users/kristinhenno/Documents/Repositories/stripe/client/src/App.js"],"names":["React","loadStripe","Elements","Success","Cart","ProductList","StripeContext","axios","BrowserRouter","Switch","Route","Link","utimes","makeStyles","Paper","Tab","useStyles","root","flexGrow","stripePromise","App","props","addItem","item","cart","state","console","log","id","quantity","localStorage","setItem","JSON","stringify","setState","removeItem","toCheckout","event","itemKeys","Object","keys","checkoutArray","i","length","product","name","price","push","price_data","currency","product_data","unit_amount","stripe","fetch","method","headers","Accept","body","data","payment_method_types","line_items","mode","allow_promotion_codes","response","json","session","redirectToCheckout","sessionId","result","error","products","getItem","get","parse","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport Success from './components/Success';\nimport Cart from './components/Cart';\nimport ProductList from './components/ProductList';\nimport StripeContext from \"./components/Context\";\nimport axios from \"axios\";\nimport {\n  BrowserRouter,\n  Switch,\n  Route,\n  Link\n} from \"react-router-dom\";\nimport { utimes } from 'fs';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Paper from '@material-ui/core/Paper';\nimport Tab from '@material-ui/core/Tab';\n\n\nconst useStyles = makeStyles({\n  root: {\n    flexGrow: 1,\n  },\n});\n// import styled from \"styled-components\";\nconst stripePromise = loadStripe('pk_test_9cWSl1Mlu5mEFLGQajwgixZx00gIx5qQeQ');\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      cart: [],\n      products: []\n    };\n    // this.routerRef = React.createRef();\n\n  }\n\n  addItem = item => {\n    let cart = this.state.cart;\n    console.log(cart);\n    if (cart[item.id]) {\n      cart[item.id].quantity += item.quantity;\n    } else {\n      cart[item.id] = item;\n    }\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n    this.setState({ cart: cart });\n  };\n\n  removeItem = item => {\n    let cart = this.state.cart;\n    if (cart[item.id]) {\n      cart[item.id].quantity -= item.quantity;\n      if (cart[item.id].quantity === 0) {\n        delete cart[item.id]\n      }\n    }\n\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n    this.setState({ cart: cart });\n  }\n\n  toCheckout = async (event) => {\n    let cart = this.state.cart;\n    const itemKeys = Object.keys(this.state.cart || {});\n    let checkoutArray = [];\n\n    var i;\n    for (i = 0; i < itemKeys.length; i++) {\n\n      console.log(cart[itemKeys[i]].product.name)\n      let price = cart[itemKeys[i]].product.price * 100;\n\n      console.log(price);\n      checkoutArray.push({\n\n\n\n        price_data: {\n          currency: 'usd',\n          product_data: {\n            name: cart[itemKeys[i]].product.name,\n          },\n          unit_amount: price,\n        },\n        quantity: cart[itemKeys[i]].quantity,\n      })\n\n      console.log(checkoutArray)\n    }\n    // Get Stripe.js instance\n    const stripe = await stripePromise;\n\n    // Call your backend to create the Checkout Session\n    const response = await fetch('/create-checkout-session', {\n      method: 'POST',\n      headers: {\n        Accept: 'application/json',\n        'Content-type': 'application/json'\n      },\n      body: JSON.stringify({\n        data: {\n          payment_method_types: ['card'],\n          line_items: checkoutArray,\n          mode: 'payment',\n          allow_promotion_codes: true,\n        }\n      })\n\n\n\n    });\n\n    console.log(response);\n\n    const session = await response.json();\n\n    console.log(session);\n\n    // When the customer clicks on the button, redirect them to Checkout.\n    const result = await stripe.redirectToCheckout({\n      sessionId: session.id,\n    });\n\n\n    if (result.error) {\n      // If `redirectToCheckout` fails due to a browser or network\n      // error, display the localized error message to your customer\n      // using `result.error.message`.\n    }\n\n  }\n\n  async componentDidMount() {\n    let cart = localStorage.getItem(\"cart\");\n    const products = await axios.get('/products');\n    cart = cart ? JSON.parse(cart) : {};\n    this.setState({\n      products: products.data,\n      cart: cart\n    });\n  }\n\n  render() {\n    console.log(this.state.cart)\n    return (\n      <StripeContext.Provider\n        value={{\n          ...this.state,\n          removeItem: this.removeItem,\n          addItem: this.addItem,\n          toCheckout: this.toCheckout\n        }}\n      >\n        <BrowserRouter >\n\n          <Paper >\n            <Tab label=\"Products\" to='/' component={Link} />\n            <Tab label=\"Cart\" to='/cart' component={Link} />\n          </Paper>\n\n\n          <div>\n            <Switch>\n              <Route\n                exact\n                path='/'\n                component={ProductList}\n              />\n            </Switch>\n            <Switch>\n              <Route\n                exact\n                path='/success'\n                component={Success}\n              />\n            </Switch>\n            <Switch>\n              <Route\n                exact\n                path='/cart'\n                component={Cart} />\n            </Switch>\n          </div>\n        </BrowserRouter>\n      </StripeContext.Provider>\n\n    );\n  }\n}\nexport default App;\n"]},"metadata":{},"sourceType":"module"}